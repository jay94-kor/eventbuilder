# RFP 생성 및 사용자 플로우 강화 계획

## 1. RFP 생성 단계 재정의 및 사용자 플로우 개선

현재 2단계로 나뉜 RFP 생성 흐름을 사용자에게 더 직관적이고 단계적인 경험을 제공하도록 재정의합니다.

### 단계 1: 기본 정보 입력 (Event Basic Info)
*   **목표**: RFP의 기본적인 정보(이벤트 이름, 날짜, 예상 참가자 수 등)를 입력받습니다.
*   **UI 요소**:
    *   이벤트/RFP 제목 (필수)
    *   이벤트 날짜 (선택)
    *   예상 참가자 수 (선택)
    *   총 예산 (선택, 미정 옵션 포함)
    *   RFP 설명 (선택)
*   **로직**: 입력된 기본 정보를 임시 저장하거나 다음 단계로 전달합니다.

### 단계 2: 기능 선택 (Feature Selection)
*   **목표**: 사용자가 필요한 기능들을 카테고리별로 탐색하고 선택합니다.
*   **UI 요소**:
    *   `FeatureCategory` 목록 (탭 또는 아코디언 형태)
    *   각 카테고리 내 `Feature` 목록 (체크박스 또는 토글 형태)
    *   선택된 기능 목록 요약 표시
    *   **개선**: 기능 선택 시, 해당 기능과 관련된 **추천 기능(recommendations)**을 사용자에게 시각적으로 제시하고, 쉽게 추가할 수 있도록 유도합니다. (예: "이 기능을 선택하면 다음 기능도 함께 고려해보세요!")
*   **로직**: 선택된 기능 ID를 Zustand 스토어에 저장합니다.

### 단계 3: 상세 설정 및 예산 분배 (Feature Configuration & Budget Allocation)
*   **목표**: 선택된 각 기능에 대한 상세 정보를 입력하고, 예산을 할당합니다.
*   **UI 요소**:
    *   선택된 각 기능에 대한 `DynamicFeatureForm` 렌더링.
    *   각 폼 필드 옆에 `allow_undecided` 옵션이 있는 경우 "미정" 체크박스/토글 제공.
    *   **개선**: 각 기능별 예산 입력 필드 추가.
    *   **개선**: 총 예산이 입력된 경우, 각 기능별 예산 합계와 총 예산을 비교하여 초과 여부를 실시간으로 표시합니다. (프론트엔드에서 1차 검증, 백엔드 `validateBudget` 활용)
    *   **개선**: `internal_resource` 토글이 ON일 경우, 예산 입력 필드를 비활성화하고 `internal_resource_person` 필드를 활성화합니다.
    *   **개선**: `feature_zones`의 `options`는 사용자가 직접 존 이름을 입력하여 추가할 수 있도록 합니다. (예: 텍스트 입력 필드와 "추가" 버튼 조합)
    *   **개선**: 각 기능의 "준비 마감 시점"과 "납품 완료 시점" 필드는 사용자가 직접 입력하도록 하되, 이벤트 날짜와의 유효성(예: 기능 날짜가 이벤트 날짜보다 빠르거나 같아야 함)을 검증하는 로직을 추가합니다.
*   **로직**: `featureDetails` 객체에 각 기능의 폼 데이터를 저장하고, 예산 정보를 추가합니다. 최종 RFP 저장 시 이 데이터를 백엔드로 전송합니다.

### 단계 4: RFP 검토 및 제출 (Review & Submit)
*   **목표**: 사용자가 입력한 모든 정보를 최종적으로 검토하고 RFP를 제출합니다.
*   **UI 요소**:
    *   RFP 기본 정보 요약
    *   선택된 기능 및 상세 설정 요약 (읽기 전용)
    *   총 예산 및 예산 분배 현황 요약
    *   최종 제출 버튼
*   **로직**: 모든 데이터의 최종 유효성을 검사하고, 백엔드에 RFP를 최종 저장합니다.

## 2. 백엔드 API 및 데이터 모델 개선 (필요시)

*   **RFP 모델 확장**:
    *   `Rfp` 모델에 `total_budget`, `is_total_budget_undecided`, `expected_attendees`, `description` 필드 추가.
*   **RfpSelection 모델 확장**:
    *   `RfpSelection` 모델에 `allocated_budget`, `is_budget_undecided` 필드 추가.
*   **API 엔드포인트**:
    *   `POST /rfps`: RFP 생성 시 모든 단계의 데이터를 한 번에 받도록 `StoreRfpRequest`를 업데이트합니다.
    *   `GET /features`: 기능 목록 조회 시 `config.fields` 및 `recommendations` 데이터를 포함하여 프론트엔드에서 동적 폼 및 추천 기능을 렌더링할 수 있도록 합니다.
*   **예산 검증 로직 강화**:
    *   `RfpController`의 `validateBudget` 메서드를 활용하여 프론트엔드에서 실시간 예산 검증을 지원하고, 최종 제출 시 서버 측 유효성 검사를 강화합니다.

## 3. 필라멘트 시드 데이터 활용 및 확장

*   `FeatureSeeder.php`에 정의된 `config.fields`의 `allow_undecided` 속성을 프론트엔드에서 활용하여 "미정" 옵션을 제공합니다.
*   `recommendations` 데이터를 활용하여 기능 선택 시 추천 기능을 제시하는 UI를 구현합니다.
*   `budget_allocation` 및 `internal_resource_flag`를 활용하여 예산 입력 필드 활성화/비활성화 및 내부 담당자 입력 필드 활성화 로직을 구현합니다.

## 4. Mermaid 다이어그램으로 사용자 플로우 시각화

```mermaid
graph TD
    A[사용자 시작] --> B{RFP 생성 시작};
    B --> C[단계 1: 기본 정보 입력];
    C --> D{총 예산 입력 여부?};
    D -- 예 --> E[총 예산 입력];
    D -- 아니오 / 미정 --> F[총 예산 미정];
    E --> G[단계 2: 기능 선택];
    F --> G;
    G --> H{기능 선택 및 추천 기능 확인};
    H --> I[단계 3: 상세 설정 및 예산 분배];
    I --> J{각 기능별 상세 정보 입력};
    J --> K{내부 리소스 사용 여부 확인};
    K -- 예 --> L[내부 담당자 입력];
    K -- 아니오 --> M[예산 입력 활성화];
    L --> N[예산 입력 (선택)];
    M --> N;
    N --> O{총 예산 초과 여부 실시간 검증};
    O --> P[단계 4: RFP 검토 및 제출];
    P --> Q{최종 유효성 검사};
    Q -- 유효성 통과 --> R[RFP 제출];
    Q -- 유효성 실패 --> S[오류 메시지 표시 및 수정 요청];
    R --> T[RFP 생성 완료];
    S --> I;
    T --> U[대시보드 또는 RFP 상세 페이지로 이동];